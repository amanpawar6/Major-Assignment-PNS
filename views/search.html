<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script>
        async function postData(url = '', data = {}) {
            var token = window.localStorage.getItem('token');
            const response = await fetch(url, {
                method: 'POST',
                mode: 'cors',
                cache: 'no-cache',
                credentials: 'same-origin',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': 'Bearer ' + token
                },
                redirect: 'follow',
                referrerPolicy: 'no-referrer',
                body: JSON.stringify(data)
            });
            return response.json();
        }

        function showFriends() {
            var qry = document.getElementById("searchtxt").value;
            var lst = document.getElementById("suggestion");
            postData('http://localhost:3000/findfriend', {
                name: qry
            }).then(data => {
                data.forEach(p => {
                    lst.innerHTML += p.name + "<button id=addfri>Add Friend</button>"
                   
                    let addf=document.getElementById("addfri").addEventListener('click', function(){ addFriend(p._id)})
                });
            }).catch(function (error) {
                console.log(error);
            });
        }

        function addFriend(id) {
    
            postData('http://localhost:3000/addfriend', {
                id: id
             }).then(data => {
                alert(data.msg);
            }).catch(function (error) {
               alert(error);
            });
        }
    </script>
    <title>Document</title>
</head>

<body>

    <div align="center">
        <table>
            <th>
                <tr> <input type="txt" name="search" id="searchtxt" placeholder="search friends"><br></tr>
                <button id="searchbtn" onclick="showFriends()">Search</button></tr>
            </th>
        </table>

    </div>

    <div id="suggestion" align="center">

    </div>

</body>

</html>